{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết người dùng - Library SOA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Chi tiết người dùng</h4>
                    <a href="/" class="btn btn-secondary">← Quay lại</a>
                </div>
                <div class="card-body">
                    {% if error %}
                        <div class="alert alert-danger">{{ error }}</div>
                    {% elif user %}
                        <div id="userInfo">
                            <div class="row mb-3">
                                <div class="col-sm-3"><strong>ID:</strong></div>
                                <div class="col-sm-9">{{ user.id }}</div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-sm-3"><strong>Tên người dùng:</strong></div>
                                <div class="col-sm-9">
                                    <span id="username-display">{{ user.username }}</span>
                                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="editField('username')">Sửa</button>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-sm-3"><strong>Email:</strong></div>
                                <div class="col-sm-9">
                                    <span id="email-display">{{ user.email }}</span>
                                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="editField('email')">Sửa</button>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-sm-3"><strong>Ngày tạo:</strong></div>
                                <div class="col-sm-9">{{ user.created_at }}</div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button class="btn btn-danger" onclick="deleteUser({{ user.id }})">Xóa người dùng</button>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const userId = {{ user.id|default:"null" }};

async function editField(field) {
    const currentValue = document.getElementById(field + '-display').textContent;
    const newValue = prompt(`Nhập ${field === 'username' ? 'tên người dùng' : 'email'} mới:`, currentValue);
    
    if (newValue && newValue !== currentValue) {
        try {
            const response = await fetch(`/api/user/users/${userId}/`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ [field]: newValue })
            });
            
            if (response.ok) {
                document.getElementById(field + '-display').textContent = newValue;
                alert('Cập nhật thành công!');
            } else {
                alert('Lỗi khi cập nhật!');
            }
        } catch (error) {
            alert('Lỗi kết nối!');
        }
    }
}

async function deleteUser(id) {
    if (confirm('Bạn có chắc chắn muốn xóa người dùng này?')) {
        try {
            const response = await fetch(`/api/user/users/${id}/`, {
                method: 'DELETE'
            });
            
            if (response.ok) {
                alert('Xóa thành công!');
                window.location.href = '/';
            } else {
                alert('Lỗi khi xóa!');
            }
        } catch (error) {
            alert('Lỗi kết nối!');
        }
    }
}
</script>
</body>
</html>
